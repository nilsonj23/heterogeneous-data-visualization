<!DOCTYPE html>
<html>
  <head>
    <!--  <title><%= title %></title> -->
    <title>Vizualização de Dados Heterogêneos</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

    <link rel='stylesheet' href='/stylesheets/style.css' />

    <!-- JQuery -->
    <script type="text/javascript" src="/jquery/jquery-3.5.1.min.js"></script>

    <!-- Load d3.js -->
    <script type="text/javascript" src="https://d3js.org/d3.v4.js"></script>

    <!-- Funcionalidades -->
    <script type="text/javascript" src="/js/exemplo.js?v=datetime()"></script>
  
  </head>

  <body>
    <!--
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
      -->
    <!------------------------------------------------------  Menu ------------------------------------------------------>

    <nav class="navbar navbar-expand-sm bg-dark navbar-dark mr-5">
      <ul class="navbar-nav ">
        <li class="nav-item ">
          <a class="nav-link" href="#">Views Data</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="#">Início</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Visualização</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Sobre</a>
        </li>
      </ul>
    </nav>

  <div class="container">

    <button class="btn btn-success mt-2 text-center btn-sm" type="button" id="btGraficoPIB">Gráfico PIB</button>

    <div>
      <div id="content" class="col-sm-6">

              <table class="table">
                  <tr>
                      <th>UF</th>
                      <th>PIB</th>
                      <th>COVID</th>
                  </tr>
              <% for (item of content){%>
                  <tr>
                      <td><%= item.uf %></td>
                      <td><%= item.pib %></td>
                      <td><%= item.covid %></td>
                  </tr>
              <% } %>
              </table>

      </div>

      <div id="chart" class="col-sm-6">
      </div>

    </div>
  </div>

  <script type="text/javascript">
  
    var dataset;

    var chartBuilded = 0;
    var margin;
    var svg;
    var x;
    var xAxis;
    var y;
    var yAxis;

    function iniciarGrafico() {

      chartBuilded = 1;

      // set the dimensions and margins of the graph
      margin = {top: 30, right: 30, bottom: 70, left: 60},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

      // append the svg object
      svg = d3.select("#chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

      // Initialize the X axis
      x = d3.scaleBand()
        .range([ 0, width ])
        .padding(0.2);

      xAxis = svg.append("g")
        .attr("transform", "translate(0," + height + ")")

      // Initialize the Y axis
      y = d3.scaleLinear()
        .range([ height, 0]);

      yAxis = svg.append("g")
        .attr("class", "myYaxis")

      titulo = svg.append("text")
        .attr("id", "header")
        .attr("x", 0 )
        .attr("y", -10 )
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("fill","#808080");

    }

    // A function that create / update the plot for a given variable:
    function updateGrafico(selectedVar) {

      if (chartBuilded == 0) iniciarGrafico();

      
      dataset = [
        { uf: 'RJ', pib: 1100, covid:	20 },
        { uf: 'ES', pib: 1000, covid:	8 },
        { uf: 'SP', pib: 2100, covid:	22 },
        { uf: 'MG', pib: 1300, covid:	17 },
        { uf: 'RS', pib: 1500, covid:	8 },
        { uf: 'PR', pib: 1200, covid:	13 },
        { uf: 'SC', pib: 1300, covid:	14 },
      ];
      
      data = dataset;

      // X axis
      x.domain(data.map(function(d) { return d.uf; }))
      xAxis.transition().duration(1000).call(d3.axisBottom(x))

      // Add Y axis
      y.domain([0, d3.max(data, function(d) { return +d[selectedVar] }) ]);
      yAxis.transition().duration(1000).call(d3.axisLeft(y));

      // variable u: map data to existing bars
      var u = svg.selectAll("rect").data(data);

      // update bars
      u.enter()
        .append("rect")
        .merge(u)
        .transition()
        .duration(1000)
        .attr("x", function(d) { return x(d.uf); })
        .attr("y", function(d) { return y(d[selectedVar]); })
        .attr("width", x.bandwidth())
        .attr("height", function(d) { return height - y(d[selectedVar]); })
        .attr("class", function(d) { 
          if (d.uf == "RJ")
            return "barra_azul"; 
          else
            return "barra_vermelha"; 
        })

      if (selectedVar == 'pib')
        tmp = "Produto Interno Bruto por Unidade da Federação";
      else
        tmp = "Número de mortes COVID por Unidade da Federação";

      svg.select("#header")
        .text(tmp);

    }

		$( document ).ready(function() {
		
			$( "#btGraficoPIB" ).click(function( e ) {
				updateGrafico('pib');
			});

		});
	</script>

  </body>
</html>
